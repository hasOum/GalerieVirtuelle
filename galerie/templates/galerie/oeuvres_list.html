{% extends 'galerie/base.html' %}
{% load static %}

{% block title %}Œuvres | GalerieVirtuelle{% endblock %}

{% block content %}

{# CSS page (crée ce fichier en static) #}
<link rel="stylesheet" href="{% static 'galerie/css/oeuvres.css' %}">

<div class="container py-4">

  {# HERO #}
  <div class="oeuvre-hero d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-3 mb-4">
    <div>
      <h1 class="oeuvre-title mb-1">Œuvres</h1>
      <div class="oeuvre-subtitle">Explorez, recherchez et filtrez les œuvres disponibles.</div>
    </div>

    <div class="oeuvre-count">
      {{ oeuvres|length }} résultat{{ oeuvres|length|pluralize }}
    </div>
  </div>

  {# FILTER CARD #}
  <div class="oeuvre-filter-card p-3 p-md-4 mb-4">
    <form method="get" class="row g-3 align-items-end">

      <div class="col-md-5">
        <label class="form-label mb-1">Mot clé</label>
        <input class="form-control" type="text" name="q"
               placeholder="Titre, artiste, description..."
               value="{{ q }}">
      </div>

      <div class="col-md-3">
        <label class="form-label mb-1">Catégorie</label>
        <select class="form-select" name="categorie">
          <option value="">Toutes catégories</option>
          {% for c in categories %}
            <option value="{{ c.id }}" {% if cat_id == c.id|stringformat:"s" %}selected{% endif %}>
              {{ c.nom_categorie }}
            </option>
          {% endfor %}
        </select>
      </div>

      {# Optionnel: si tu filtres aussi par année, sinon supprime ce bloc #}
      <div class="col-md-2">
        <label class="form-label mb-1">Année</label>
        <input class="form-control" type="number" name="annee" placeholder="ex: 2020" value="{{ annee }}">
      </div>

      <div class="col-md-2 d-grid">
        <button class="btn btn-gradient" type="submit">Filtrer</button>
      </div>

      <div class="col-12">
        <a class="btn btn-outline-secondary" href="{% url 'galerie:oeuvres_list' %}">Reset</a>
      </div>
    </form>
  </div>

  {# LIST / CARDS #}
  <div class="row g-4">
    {% for o in oeuvres %}
      <div class="col-12 col-md-6 col-lg-4">
        <div class="oeuvre-card h-100">

          <div class="oeuvre-img-wrap">
            {% if o.image %}
              <img class="oeuvre-img" src="{{ o.image.url }}" alt="{{ o.titre }}">
            {% else %}
              <div class="oeuvre-img oeuvre-img-placeholder d-flex align-items-center justify-content-center">
                <span class="text-muted fw-semibold">Aucune image</span>
              </div>
            {% endif %}

            {% if o.categorie %}
              <div class="oeuvre-badge">{{ o.categorie.nom_categorie }}</div>
            {% endif %}
          </div>

          <div class="oeuvre-body">
            <h5 class="oeuvre-name">{{ o.titre }}</h5>

            {% if o.artiste %}
              <div class="oeuvre-artist">{{ o.artiste }}</div>
            {% endif %}

            {% if o.description %}
              <div class="oeuvre-desc">{{ o.description|truncatewords:20 }}</div>
            {% endif %}

            <div class="oeuvre-meta mt-3">
              {% if o.annee %}
                <div class="oeuvre-meta-item">
                  <span class="oeuvre-meta-label">Année</span>
                  <span class="oeuvre-meta-value">{{ o.annee }}</span>
                </div>
              {% endif %}
            </div>

            {# Bouton détail: active-le seulement si ton urls.py a bien name='oeuvre_detail' #}
            <div class="mt-3">
              <a class="btn btn-outline-dark w-100" href="{% url 'galerie:oeuvre_detail' o.id %}"> 
              Détails
              </a>
            </div>

          </div>
        </div>
      </div>

    {% empty %}
      <div class="col-12">
        <div class="oeuvre-empty text-center p-4 p-md-5">
          <h4 class="mb-2">Aucune œuvre trouvée</h4>
          <div class="text-muted mb-3">Essayez de modifier les filtres ou de réinitialiser la recherche.</div>
          <a class="btn btn-outline-secondary" href="{% url 'galerie:oeuvres_list' %}">Reset</a>
        </div>
      </div>
    {% endfor %}
  </div>

</div>
{% endblock %}
