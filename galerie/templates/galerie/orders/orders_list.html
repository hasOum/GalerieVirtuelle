{% extends 'galerie/base.html' %}
{% load static %}
{% block title %}Mes commandes - Galerie Virtuelle{% endblock %}

{% block extra_css %}
<style>
  :root {
    --g1: #243748;
    --g2: #4B749F;
    --accent: #FF6B6B;
    --success: #4CAF50;
    --warning: #FFC107;
    --info: #17A2B8;
  }

  .orders-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }

  .orders-header {
    background: linear-gradient(135deg, var(--g1) 0%, var(--g2) 100%);
    color: white;
    padding: 2.5rem;
    border-radius: 15px;
    margin-bottom: 2rem;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
  }

  .orders-header h1 {
    margin: 0;
    font-size: 2rem;
    font-weight: 800;
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .orders-header p {
    margin: 0.5rem 0 0 0;
    opacity: 0.9;
    font-size: 1rem;
  }

  .orders-grid {
    display: grid;
    gap: 1.5rem;
  }

  .order-card {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    border-left: 5px solid var(--g2);
  }

  .order-card:hover {
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    transform: translateY(-2px);
  }

  .order-card.en_cours {
    border-left-color: var(--warning);
  }

  .order-card.payee {
    border-left-color: var(--success);
  }

  .order-card.annulee {
    border-left-color: var(--accent);
  }

  .order-header {
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    padding: 1.5rem;
    background: #f8f9fa;
    border-bottom: 1px solid #e9ecef;
    gap: 2rem;
  }

  .order-id {
    font-weight: 800;
    color: var(--g1);
    font-size: 1.3rem;
  }

  .order-date {
    color: #666;
    font-size: 0.9rem;
  }

  .order-status-badge {
    display: inline-block;
    padding: 0.5rem 1rem;
    border-radius: 25px;
    font-size: 0.85rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .order-status-badge.en_cours {
    background-color: rgba(255, 193, 7, 0.15);
    color: var(--warning);
  }

  .order-status-badge.payee {
    background-color: rgba(76, 175, 80, 0.15);
    color: var(--success);
  }

  .order-status-badge.annulee {
    background-color: rgba(255, 107, 107, 0.15);
    color: var(--accent);
  }

  .order-status-badge.validee {
    background-color: rgba(23, 162, 184, 0.15);
    color: var(--info);
  }

  .order-content {
    padding: 1.5rem;
  }

  .order-items {
    margin-bottom: 1.5rem;
  }

  .order-item {
    display: grid;
    grid-template-columns: 1fr auto;
    align-items: center;
    padding: 0.75rem 0;
    border-bottom: 1px solid #e9ecef;
    gap: 1rem;
  }

  .order-item:last-child {
    border-bottom: none;
  }

  .item-name {
    color: var(--g1);
    font-weight: 600;
  }

  .item-qty {
    color: #666;
    font-size: 0.9rem;
  }

  .item-price {
    color: var(--g2);
    font-weight: 700;
  }

  .order-summary {
    background: linear-gradient(135deg, rgba(36, 55, 72, 0.05), rgba(75, 116, 159, 0.05));
    padding: 1.5rem;
    border-radius: 8px;
    margin-top: 1.5rem;
  }

  .summary-row {
    display: grid;
    grid-template-columns: 1fr auto;
    padding: 0.5rem 0;
    align-items: center;
  }

  .summary-label {
    color: #666;
    font-weight: 600;
  }

  .summary-value {
    text-align: right;
    color: var(--g1);
    font-weight: 600;
  }

  .summary-row.total {
    border-top: 2px solid #ddd;
    padding-top: 1rem;
    margin-top: 1rem;
  }

  .summary-row.total .summary-label {
    font-size: 1.1rem;
    color: var(--g1);
    font-weight: 800;
  }

  .summary-row.total .summary-value {
    font-size: 1.3rem;
    color: var(--g2);
    font-weight: 800;
  }

  .order-actions {
    display: flex;
    gap: 0.75rem;
    padding-top: 1.5rem;
    border-top: 1px solid #e9ecef;
    flex-wrap: wrap;
  }

  .btn-action {
    padding: 0.6rem 1.2rem;
    border-radius: 6px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
  }

  .btn-action.primary {
    background-color: var(--success);
    color: white;
  }

  .btn-action.primary:hover {
    background-color: #45a049;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
  }

  .btn-action.secondary {
    background-color: #e9ecef;
    color: var(--g1);
  }

  .btn-action.secondary:hover {
    background-color: #dee2e6;
    transform: translateY(-2px);
  }

  .btn-action.danger {
    background-color: rgba(255, 107, 107, 0.1);
    color: var(--accent);
    border: 1px solid var(--accent);
  }

  .btn-action.danger:hover {
    background-color: var(--accent);
    color: white;
    transform: translateY(-2px);
  }

  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: linear-gradient(135deg, rgba(36, 55, 72, 0.05), rgba(75, 116, 159, 0.05));
    border-radius: 15px;
    border: 2px dashed #ddd;
  }

  .empty-state i {
    font-size: 4rem;
    color: #ccc;
    margin-bottom: 1rem;
  }

  .empty-state h3 {
    color: #666;
    font-weight: 700;
    margin-bottom: 0.5rem;
  }

  .empty-state p {
    color: #999;
    margin: 0;
  }

  @media (max-width: 768px) {
    .order-header {
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    .order-id {
      font-size: 1.1rem;
    }

    .orders-header h1 {
      font-size: 1.5rem;
    }

    .order-items {
      max-height: 300px;
      overflow-y: auto;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="orders-container">
  <div class="orders-header">
    <h1>
      <i class="bi bi-receipt"></i>
      Mes Commandes
    </h1>
    <p>Suivi de vos commandes et paiements</p>
  </div>

  {% if commandes %}
    <div class="orders-grid">
      {% for commande in commandes %}
        <div class="order-card {{ commande.statut }}">
          <!-- En-tête de la commande -->
          <div class="order-header">
            <div>
              <div class="order-id">Commande #{{ commande.id }}</div>
              <div class="order-date">
                <i class="bi bi-calendar"></i>
                {{ commande.date_commande|date:"d M Y à H:i" }}
              </div>
            </div>
            <div></div>
            <div class="order-status-badge {{ commande.statut }}">
              {% if commande.statut == 'en_cours' %}
                <i class="bi bi-hourglass-split"></i> En cours
              {% elif commande.statut == 'payee' %}
                <i class="bi bi-check-circle"></i> Payée
              {% elif commande.statut == 'annulee' %}
                <i class="bi bi-x-circle"></i> Annulée
              {% elif commande.statut == 'validee' %}
                <i class="bi bi-check2-all"></i> Validée
              {% else %}
                {{ commande.get_statut_display|default:commande.statut }}
              {% endif %}
            </div>
          </div>

          <!-- Contenu de la commande -->
          <div class="order-content">
            <!-- Articles de la commande -->
            <div class="order-items">
              {% for ligne in commande.lignes.all %}
                <div class="order-item">
                  <div>
                    <div class="item-name">{{ ligne.oeuvre.titre }}</div>
                    <div class="item-qty">Quantité: <strong>{{ ligne.quantite }}</strong></div>
                  </div>
                  <div class="item-price">
                    {{ ligne.prix_unitaire|floatformat:2 }}€
                  </div>
                </div>
              {% empty %}
                <p style="color: #999; text-align: center;">Aucun article</p>
              {% endfor %}
            </div>

            <!-- Résumé de la commande -->
            <div class="order-summary">
              <div class="summary-row">
                <span class="summary-label">Sous-total:</span>
                <span class="summary-value">{{ commande.montant_total|floatformat:2 }}€</span>
              </div>
              <div class="summary-row">
                <span class="summary-label">Frais de port:</span>
                <span class="summary-value">5.00€</span>
              </div>
              <div class="summary-row total">
                <span class="summary-label">TOTAL:</span>
                <span class="summary-value">{{ commande.montant_total|add:5|floatformat:2 }}€</span>
              </div>
            </div>

            <!-- Actions -->
            <div class="order-actions">
              {% if commande.statut == 'en_cours' %}
                <a href="{% url 'galerie:order_pay' commande.id %}" class="btn-action primary">
                  <i class="bi bi-credit-card"></i> Payer maintenant
                </a>
                <a href="{% url 'galerie:order_cancel' commande.id %}" class="btn-action danger" onclick="return confirm('Êtes-vous sûr de vouloir annuler cette commande ?');">
                  <i class="bi bi-trash"></i> Annuler
                </a>
              {% elif commande.statut == 'payee' %}
                <span style="color: var(--success); font-weight: 600;">
                  <i class="bi bi-check-circle"></i> Commande payée et confirmée
                </span>
              {% endif %}
              <a href="javascript:void(0)" class="btn-action secondary" onclick="window.print()">
                <i class="bi bi-printer"></i> Imprimer
              </a>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="empty-state">
      <i class="bi bi-inbox"></i>
      <h3>Aucune commande</h3>
      <p>Vous n'avez pas encore passé de commande. <a href="{% url 'galerie:oeuvres_list' %}" style="color: var(--g2); text-decoration: none; font-weight: 600;">Explorez nos œuvres</a></p>
    </div>
  {% endif %}
</div>
{% endblock %}
